@echo off & cd /d "%~dp0" & title ET COMPENDIUM EXTRACTOR (SPLIT MODE) & echo [STATUS] Launching Discrete Page Extraction... & python -x "%~f0" %* & pause & goto :eof
import os
import sys
import subprocess
import importlib.util

# --- EXCEPTION THEORY EXTRACTOR (DISCRETE MODE) ---

def install_and_import(package):
    """Checks for a library and installs it if missing."""
    if importlib.util.find_spec(package) is None:
        print(f"[*] Dependency '{package}' not found. Installing via pip...")
        try:
            subprocess.check_call([sys.executable, "-m", "pip", "install", package])
            print(f"[*] '{package}' installed.")
        except subprocess.CalledProcessError:
            print(f"[!] ERROR: Could not install '{package}'. Check your internet connection.")
            sys.exit(1)
    return importlib.import_module(package)

def main():
    # 1. SETUP
    pdf_filename = "ET Math Compendium.pdf"
    output_dir = "compendium_extracted"
    
    print(f"[*] Target File: {pdf_filename}")
    
    if not os.path.exists(pdf_filename):
        print(f"[!] CRITICAL ERROR: '{pdf_filename}' is missing!")
        print(f"    Current Folder: {os.getcwd()}")
        print("    Please move this script into the folder containing the PDF.")
        sys.exit(1)

    # 2. LOAD LIBRARIES
    try:
        pypdf = install_and_import("pypdf")
    except Exception as e:
        print(f"[!] Python Environment Error: {e}")
        sys.exit(1)

    # 3. PREPARE OUTPUT
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)
        print(f"[*] Created output directory: {output_dir}")

    # 4. EXECUTE EXTRACTION
    try:
        reader = pypdf.PdfReader(pdf_filename)
        total_pages = len(reader.pages)
        print(f"[*] PDF Loaded. Total Pages: {total_pages}")
        print(f"[*] Splitting into discrete Descriptor files...")
        
        # LOOP THROUGH PAGES AND SAVE INDIVIDUALLY
        for i, page in enumerate(reader.pages):
            page_num = i + 1
            text = page.extract_text()
            
            if text:
                # Create individual filename
                page_filename = f"ET_Compendium_Page_{page_num:02d}.txt"
                page_path = os.path.join(output_dir, page_filename)
                
                with open(page_path, "w", encoding="utf-8") as f:
                    f.write(text)
                
                # Visual feedback
                print(f"   [+] Saved: {page_filename}")
            else:
                print(f"   [!] Page {page_num} is empty or unreadable.")

        # 5. HANDLE ATTACHMENTS (Secondary Check)
        if hasattr(reader, "attachments") and reader.attachments:
            print(f"\n[*] Found embedded attachments. Extracting...")
            for filename, data in reader.attachments.items():
                if isinstance(data, list): data = data[0]
                try:
                    if hasattr(data, "get_data"):
                        file_bytes = data.get_data()
                    else:
                        file_bytes = data
                    
                    out_path = os.path.join(output_dir, f"ATTACHMENT_{filename}")
                    with open(out_path, "wb") as f:
                        f.write(file_bytes)
                    print(f"   [+] Extracted Attachment: {filename}")
                except Exception as att_err:
                    print(f"   [!] Failed to extract {filename}: {att_err}")

        print("\n[SUCCESS] Extraction Complete.")
        print(f"[*] Data located in: {os.path.abspath(output_dir)}")

    except Exception as e:
        print(f"\n[!] EXTRACTION FAILED: {e}")
        print("    Ensure the PDF is not encrypted or corrupted.")

if __name__ == "__main__":
    main()