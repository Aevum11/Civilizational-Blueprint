@echo off
setlocal
:: Configuration - The name of your source file
set "JSX_FILE=ET_Periodic_Omniverse.jsx"
set "APP_FILE=ET_Application.html"

if not exist "%JSX_FILE%" (
    echo.
    echo ERROR: %JSX_FILE% not found.
    echo Please make sure this batch file is in the same folder as "%JSX_FILE%".
    echo.
    pause
    exit /b
)

echo Building ET Application Viewer...

:: Write the HTML Header and Environment Setup
(
    echo ^<!DOCTYPE html^>
    echo ^<html lang="en"^>
    echo ^<head^>
    echo     ^<meta charset="UTF-8"^>
    echo     ^<title^>ET Periodic Table Omniverse^</title^>
    echo     ^<script src="https://cdn.tailwindcss.com"^>^</script^>
    echo     ^<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"^>^</script^>
    echo     ^<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"^>^</script^>
    echo     ^<script src="https://unpkg.com/@babel/standalone/babel.min.js"^>^</script^>
    echo     ^<style^>body { background-color: #0f172a; color: #e2e8f0; }^</style^>
    echo ^</head^>
    echo ^<body^>
    echo     ^<div id="root"^>^</div^>
    echo     ^<script type="text/babel"^>
    echo         // --- ENVIRONMENT POLYFILLS ---
    echo         const { useState, useMemo, useEffect } = React;
    echo         // Mock Icons to ensure code runs without 'lucide-react' build step
    echo         const Icon = ^(p^) =^> ^<svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"^>^<rect x="2" y="2" width="20" height="20" rx="5" ry="5"^>^</rect^>^</svg^>;
    echo         const ChevronLeft=Icon; const ChevronRight=Icon; const Home=Icon; const Atom=Icon; 
    echo         const Layers=Icon; const Zap=Icon; const Activity=Icon; const Target=Icon; 
    echo         const Clock=Icon; const Shield=Icon; const AlertTriangle=Icon; const Info=Icon;
    echo.
) > "%APP_FILE%"

:: Inject the User's JSX Code (Skipping imports/exports to prevent errors)
powershell -Command "Get-Content '%JSX_FILE%' | Where-Object { $_ -notmatch '^import' -and $_ -notmatch '^export default' } | Add-Content '%APP_FILE%'"

:: Write the Render Trigger
(
    echo.
    echo         // --- LAUNCHER ---
    echo         const root = ReactDOM.createRoot^(document.getElementById^('root'^)^);
    echo         root.render^(^<App /^>^);
    echo     ^</script^>
    echo ^</body^>
    echo ^</html^>
) >> "%APP_FILE%"

echo Launching...
start "" "%APP_FILE%"
endlocal